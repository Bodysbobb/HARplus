<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Enhanced R Package for GEMPACK .HAR and .SL4 File Processing • HARplus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Enhanced R Package for GEMPACK .HAR and .SL4 File Processing">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HARplus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Enhanced R Package for GEMPACK .HAR and .SL4 File Processing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bodysbobb/HARplus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Enhanced R Package for GEMPACK .HAR and .SL4 File Processing</h1>
                        <h4 data-toc-skip class="author">Pattawee
Puangchit</h4>
            
            <h4 data-toc-skip class="date">2025-10-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bodysbobb/HARplus/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview-of-harplus">Overview of HARplus<a class="anchor" aria-label="anchor" href="#overview-of-harplus"></a>
</h2>
<p>The <code>HARplus</code> package enhances GEMPACK users’ experience
by streamlining <code>.har</code> and <code>.sl4</code> file processing.
It efficiently extracts, organizes, and manages dimension structures,
ensuring consistency, optimized memory usage, and simplified data
manipulation. The package enables fast data merging, aggregation, and
transformation while maintaining a consistent interface across GEMPACK
file types. Users can easily pivot data into familiar formats and export
results in various formats.</p>
<p>A key feature of <code>HARplus</code> is its <strong>flexible
subtotal level handling</strong>, allowing users to selectively retain
<code>"TOTAL"</code> values, decomposed components, or both. This
ensures precise data extraction for various economic modeling needs
without unnecessary redundancy.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers key functions of <code>HARplus</code>,
highlighting its ability to handle multiple inputs for efficient data
processing. Designed for economic modelers and GEMPACK practitioners, it
simplifies working with multiple datasets and enhances analytical
workflows.</p>
<p>Sample data used in this vignette is obtained from the GTAPv7 model
and utilizes publicly available data from the GTAP 9 database. For more
details, refer to the <a href="https://www.gtap.agecon.purdue.edu/databases/archives.asp" class="external-link">GTAP
Database Archive</a>.</p>
</div>
<div class="section level2">
<h2 id="acknowledgement">Acknowledgement<a class="anchor" aria-label="anchor" href="#acknowledgement"></a>
</h2>
<p>The development of <code>HARplus</code> builds upon the foundational
work of the <code>HARr</code> package. I sincerely acknowledge and
appreciate the contributions of Maros Ivanic, whose <code>HARr</code>
package served as the baseline for this development, advancing efficient
data handling for GEMPACK users.</p>
</div>
<div class="section level2">
<h2 id="gtapviz-an-extension-of-harplus-for-visualization">GTAPViz: An Extension of HARplus for Visualization<a class="anchor" aria-label="anchor" href="#gtapviz-an-extension-of-harplus-for-visualization"></a>
</h2>
<p>I have developed another package specifically for visualization,
particularly for GTAP users: <strong><a href="https://www.pattawee-pp.com/GTAPViz/" class="external-link">GTAPViz</a></strong></p>
<hr>
</div>
<div class="section level2">
<h2 id="installation-and-loading-example-data">Installation and Loading Example Data<a class="anchor" aria-label="anchor" href="#installation-and-loading-example-data"></a>
</h2>
<p>Before proceeding, ensure that <code>HARplus</code> is installed and
loaded:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bodysbobb/HARplus/" class="external-link">HARplus</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-data--har-and--sl4">Loading Data <code>.HAR</code> and <code>.SL4</code><a class="anchor" aria-label="anchor" href="#loading-data--har-and--sl4"></a>
</h2>
<p>First, load the example data using the following commands
<code>&lt;load_harx&gt;</code> and <code>&lt;load_sl4x&gt;</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Paths to the .har files</span></span>
<span><span class="va">har_path1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"TAR10-WEL.har"</span>, package <span class="op">=</span> <span class="st">"HARplus"</span><span class="op">)</span></span>
<span><span class="va">har_path2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"SUBT10-WEL.har"</span>, package <span class="op">=</span> <span class="st">"HARplus"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Paths to the .sl4 files</span></span>
<span><span class="va">sl4_path1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"TAR10.sl4"</span>, package <span class="op">=</span> <span class="st">"HARplus"</span><span class="op">)</span></span>
<span><span class="va">sl4_path2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"SUBT10.sl4"</span>, package <span class="op">=</span> <span class="st">"HARplus"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the .har files using load_harx()</span></span>
<span><span class="va">har_data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_harx.html">load_harx</a></span><span class="op">(</span><span class="va">har_path1</span><span class="op">)</span></span>
<span><span class="va">har_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_harx.html">load_harx</a></span><span class="op">(</span><span class="va">har_path2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the .sl4 files using load_sl4x()</span></span>
<span><span class="va">sl4_data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sl4x.html">load_sl4x</a></span><span class="op">(</span><span class="va">sl4_path1</span><span class="op">)</span></span>
<span><span class="va">sl4_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sl4x.html">load_sl4x</a></span><span class="op">(</span><span class="va">sl4_path2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extracting-data">Extracting Data<a class="anchor" aria-label="anchor" href="#extracting-data"></a>
</h2>
<p>This package allows two main ways to enhance the GEMPACK user
experience and improve user-friendliness when extracting data:<br>
1. By selecting the variable/header name using
<code>&lt;get_data_by_var&gt;</code>.<br>
2. By using dimension patterns (e.g., <code>REG*COMM</code>) with
<code>&lt;get_data_by_dims&gt;</code>.</p>
<p>Both functions have similar options:<br>
- Extract a single variable, multiple variables, or all variables (NULL
or “ALL”) from the datasets.<br>
- Extract data from a single dataset or multiple datasets.<br>
- Rename the experiment (i.e., dataset) name, which is displayed in the
<strong>Experiment</strong> column (this column is automatically added
to handle multiple dataset merges). By default, the name is the dataset
name.<br>
- Reporting data level (all, only total, only subtotals). - Rename
dimension names, which will be used as column names.<br>
- Merge data across multiple datasets within the same patterns.<br>
- For <code>&lt;get_data_by_var&gt;</code>, variables with the same name
(e.g., <code>"qo"</code>) from different experiments (<code>exp1</code>
and <code>exp2</code>) will be merged into a single final dataframe,
with the input source identified in the <strong>Experiment</strong>
column.<br>
- Similarly, for <code>&lt;get_data_by_dims&gt;</code>, data with
matching dimension patterns (e.g., <code>REG*COMM</code>) will be
merged.</p>
<p>Let’s start with the simplest example as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract data for a single variable</span></span>
<span><span class="va">data_qo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="va">sl4_data1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_qo</span><span class="op">[[</span><span class="st">"sl4_data1"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"qo"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          ACTS     REG Subtotal     Value Variable Dimension Experiment</span></span>
<span><span class="co">#&gt; 1 GrainsCrops Oceania    TOTAL -5.283822       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 2    MeatLstk Oceania    TOTAL -8.473134       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 3  Extraction Oceania    TOTAL -1.617209       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 4    ProcFood Oceania    TOTAL -3.570224       qo  ACTS*REG  sl4_data1</span></span>
<span></span>
<span><span class="co"># Extract multiple variables from multiple datasets</span></span>
<span><span class="va">data_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="st">"qgdp"</span><span class="op">)</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_multiple</span><span class="op">[[</span><span class="st">"sl4_data1"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"qo"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          ACTS     REG Subtotal     Value Variable Dimension Experiment</span></span>
<span><span class="co">#&gt; 1 GrainsCrops Oceania    TOTAL -5.283822       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 2    MeatLstk Oceania    TOTAL -8.473134       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 3  Extraction Oceania    TOTAL -1.617209       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 4    ProcFood Oceania    TOTAL -3.570224       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_multiple</span><span class="op">[[</span><span class="st">"sl4_data2"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"qo"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          ACTS     REG Subtotal     Value Variable Dimension Experiment</span></span>
<span><span class="co">#&gt; 1 GrainsCrops Oceania    TOTAL -5.283822       qo  ACTS*REG  sl4_data2</span></span>
<span><span class="co">#&gt; 2    MeatLstk Oceania    TOTAL -8.473134       qo  ACTS*REG  sl4_data2</span></span>
<span><span class="co">#&gt; 3  Extraction Oceania    TOTAL -1.617209       qo  ACTS*REG  sl4_data2</span></span>
<span><span class="co">#&gt; 4    ProcFood Oceania    TOTAL -3.570224       qo  ACTS*REG  sl4_data2</span></span>
<span></span>
<span><span class="co"># Extract all variables separately from multiple datasets</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sl4_data1" "sl4_data2"</span></span>
<span></span>
<span><span class="co"># Extract all variables and merge the same variable from multiple datasets</span></span>
<span><span class="va">data_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, merge_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_all</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "pds"            "qfd"            "pms"            "qfm"           </span></span>
<span><span class="co">#&gt;   [5] "pfd"            "pfm"            "pes"            "qes"           </span></span>
<span><span class="co">#&gt;   [9] "peb"            "qfe"            "pfe"            "ps"            </span></span>
<span><span class="co">#&gt;  [13] "qca"            "pca"            "qgd"            "qgm"           </span></span>
<span><span class="co">#&gt;  [17] "pgd"            "pgm"            "qpd"            "qpm"           </span></span>
<span><span class="co">#&gt;  [21] "ppd"            "ppm"            "qid"            "qim"           </span></span>
<span><span class="co">#&gt;  [25] "pid"            "pim"            "psave"          "qsave"         </span></span>
<span><span class="co">#&gt;  [29] "pinv"           "kb"             "qxs"            "pfob"          </span></span>
<span><span class="co">#&gt;  [33] "pcif"           "pmds"           "qst"            "y"             </span></span>
<span><span class="co">#&gt;  [37] "pop"            "pgov"           "yg"             "ug"            </span></span>
<span><span class="co">#&gt;  [41] "ppriv"          "yp"             "uepriv"         "up"            </span></span>
<span><span class="co">#&gt;  [45] "to"             "tinc"           "endwslack"      "qms"           </span></span>
<span><span class="co">#&gt;  [49] "globalcgds"     "pcgdswld"       "po"             "qo"            </span></span>
<span><span class="co">#&gt;  [53] "ao"             "pint"           "qint"           "aint"          </span></span>
<span><span class="co">#&gt;  [57] "pva"            "qva"            "ava"            "pfa"           </span></span>
<span><span class="co">#&gt;  [61] "qfa"            "afa"            "afe"            "profitslack"   </span></span>
<span><span class="co">#&gt;  [65] "aosec"          "aoreg"          "aoall"          "afcom"         </span></span>
<span><span class="co">#&gt;  [69] "afsec"          "afreg"          "afall"          "avasec"        </span></span>
<span><span class="co">#&gt;  [73] "avareg"         "avaall"         "afecom"         "afesec"        </span></span>
<span><span class="co">#&gt;  [77] "afereg"         "afeall"         "aintsec"        "aintreg"       </span></span>
<span><span class="co">#&gt;  [81] "aintall"        "pb"             "qc"             "fincome"       </span></span>
<span><span class="co">#&gt;  [85] "incomeslack"    "del_indtaxr"    "uelas"          "dpsave"        </span></span>
<span><span class="co">#&gt;  [89] "dpgov"          "dppriv"         "dpav"           "p"             </span></span>
<span><span class="co">#&gt;  [93] "au"             "dpsum"          "u"              "ppa"           </span></span>
<span><span class="co">#&gt;  [97] "qpa"            "pga"            "qga"            "pia"           </span></span>
<span><span class="co">#&gt; [101] "qia"            "qinv"           "ams"            "ptrans"        </span></span>
<span><span class="co">#&gt; [105] "qtmfsd"         "pt"             "qtm"            "atmfsd"        </span></span>
<span><span class="co">#&gt; [109] "atm"            "atf"            "ats"            "atd"           </span></span>
<span><span class="co">#&gt; [113] "atall"          "tx"             "txs"            "tm"            </span></span>
<span><span class="co">#&gt; [117] "tms"            "pr"             "qds"            "tradslack"     </span></span>
<span><span class="co">#&gt; [121] "tfd"            "tfm"            "tpd"            "tpm"           </span></span>
<span><span class="co">#&gt; [125] "tgd"            "tgm"            "tid"            "tim"           </span></span>
<span><span class="co">#&gt; [129] "tpdall"         "tpmall"         "tpreg"          "pe"            </span></span>
<span><span class="co">#&gt; [133] "qe"             "qesf"           "tfe"            "ke"            </span></span>
<span><span class="co">#&gt; [137] "rore"           "rorc"           "rental"         "rorg"          </span></span>
<span><span class="co">#&gt; [141] "cgdslack"       "expand"         "psaveslack"     "del_taxrout"   </span></span>
<span><span class="co">#&gt; [145] "del_taxrfu"     "del_taxriu"     "del_taxrpc"     "del_taxrgc"    </span></span>
<span><span class="co">#&gt; [149] "del_taxric"     "del_taxrexp"    "del_taxrimp"    "del_taxrinc"   </span></span>
<span><span class="co">#&gt; [153] "del_ttaxr"      "pfactor"        "pfactwld"       "walras_sup"    </span></span>
<span><span class="co">#&gt; [157] "walras_dem"     "walraslack"     "vxwfob"         "vmwcif"        </span></span>
<span><span class="co">#&gt; [161] "vxwreg"         "vmwreg"         "pfactreal"      "pebfactreal"   </span></span>
<span><span class="co">#&gt; [165] "pefactreal"     "psw"            "pdw"            "tot"           </span></span>
<span><span class="co">#&gt; [169] "vgdp"           "pgdp"           "qgdp"           "contgdpexp"    </span></span>
<span><span class="co">#&gt; [173] "qgdpwld"        "pgdpwld"        "vgdpwld"        "compvalad"     </span></span>
<span><span class="co">#&gt; [177] "pxw"            "vxwcom"         "vxwwld"         "vmwcom"        </span></span>
<span><span class="co">#&gt; [181] "valuew"         "valuewu"        "pxwreg"         "pxwcom"        </span></span>
<span><span class="co">#&gt; [185] "pxwwld"         "pmw"            "pmwreg"         "pmwcom"        </span></span>
<span><span class="co">#&gt; [189] "pw"             "pwu"            "qxw"            "qxwreg"        </span></span>
<span><span class="co">#&gt; [193] "qxwcom"         "qxwwld"         "qmw"            "qmwreg"        </span></span>
<span><span class="co">#&gt; [197] "qmwcom"         "qow"            "qowu"           "del_tbalc"     </span></span>
<span><span class="co">#&gt; [201] "del_tbal"       "ywld"           "del_tbalry"     "pm_cr"         </span></span>
<span><span class="co">#&gt; [205] "c1_cr"          "c2_cr"          "c3_cr"          "c1_r"          </span></span>
<span><span class="co">#&gt; [209] "c2_r"           "c3_r"           "tot2"           "uelasev"       </span></span>
<span><span class="co">#&gt; [213] "ueprivev"       "ugev"           "upev"           "qsaveev"       </span></span>
<span><span class="co">#&gt; [217] "yev"            "ypev"           "ygev"           "qpev"          </span></span>
<span><span class="co">#&gt; [221] "ysaveev"        "dpavev"         "EV"             "WEV"           </span></span>
<span><span class="co">#&gt; [225] "EV_ALT"         "WEV_ALT"        "CNTdpar"        "CNTpop"        </span></span>
<span><span class="co">#&gt; [229] "CNTqor"         "CNTqo"          "CNTqca"         "CNTqe"         </span></span>
<span><span class="co">#&gt; [233] "CNTqea"         "CNTqfer"        "CNTqfeer"       "CNTqfe"        </span></span>
<span><span class="co">#&gt; [237] "CNTqfr"         "CNTqfm"         "CNTqfd"         "CNTqpm"        </span></span>
<span><span class="co">#&gt; [241] "CNTqpd"         "CNTqpr"         "CNTqia"         "CNTqim"        </span></span>
<span><span class="co">#&gt; [245] "CNTqid"         "CNTqgr"         "CNTqgm"         "CNTqgd"        </span></span>
<span><span class="co">#&gt; [249] "CNTqxsr"        "CNTqxs"         "CNTqmsr"        "CNTqms"        </span></span>
<span><span class="co">#&gt; [253] "CNTalleffr"     "CNTalleffcr"    "CNTtotr"        "CNTpinv"       </span></span>
<span><span class="co">#&gt; [257] "CNTendwr"       "CNTendw"        "CNTtechr"       "CNTtech_ao"    </span></span>
<span><span class="co">#&gt; [261] "CNTtech_afe"    "CNTtech_ava"    "CNTtech_aint"   "CNTtech_af"    </span></span>
<span><span class="co">#&gt; [265] "CNTtech_atmfsd" "CNTtech_ams"    "CNTkb"          "qpriv"</span></span>
<span></span>
<span><span class="co"># Return all value levels</span></span>
<span><span class="va">data_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, subtotal_level <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_all</span><span class="op">[[</span><span class="st">"sl4_data1"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"qo"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          ACTS     REG Subtotal     Value Variable Dimension Experiment</span></span>
<span><span class="co">#&gt; 1 GrainsCrops Oceania    TOTAL -5.283822       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 2    MeatLstk Oceania    TOTAL -8.473134       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 3  Extraction Oceania    TOTAL -1.617209       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 4    ProcFood Oceania    TOTAL -3.570224       qo  ACTS*REG  sl4_data1</span></span>
<span></span>
<span><span class="co"># Return only TOTAL, drop subtotal</span></span>
<span><span class="va">data_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, subtotal_level <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">[[</span><span class="st">"sl4_data1"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"qo"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          ACTS     REG Subtotal     Value Variable Dimension Experiment</span></span>
<span><span class="co">#&gt; 1 GrainsCrops Oceania    TOTAL -5.283822       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 2    MeatLstk Oceania    TOTAL -8.473134       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 3  Extraction Oceania    TOTAL -1.617209       qo  ACTS*REG  sl4_data1</span></span>
<span><span class="co">#&gt; 4    ProcFood Oceania    TOTAL -3.570224       qo  ACTS*REG  sl4_data1</span></span>
<span></span>
<span><span class="co"># Return only subtotal, drop TOTAL (result is empty if there in subtotal)</span></span>
<span><span class="va">data_decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, subtotal_level <span class="op">=</span> <span class="st">"decomposed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_decomp</span><span class="op">[[</span><span class="st">"sl4_data2"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"qo"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            ACTS     REG   Subtotal Value Variable Dimension Experiment</span></span>
<span><span class="co">#&gt; 101 GrainsCrops Oceania to changes     0       qo  ACTS*REG  sl4_data2</span></span>
<span><span class="co">#&gt; 102    MeatLstk Oceania to changes     0       qo  ACTS*REG  sl4_data2</span></span>
<span><span class="co">#&gt; 103  Extraction Oceania to changes     0       qo  ACTS*REG  sl4_data2</span></span>
<span><span class="co">#&gt; 104    ProcFood Oceania to changes     0       qo  ACTS*REG  sl4_data2</span></span>
<span></span>
<span><span class="co"># Rename specific columns</span></span>
<span><span class="va">data_col_renamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="va">sl4_data1</span>, </span>
<span>                             rename_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>REG <span class="op">=</span> <span class="st">"Region"</span>, COMM <span class="op">=</span> <span class="st">"Commodity"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data_col_renamed</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ sl4_data1:List of 1</span></span>
<span><span class="co">#&gt;   ..$ qo:'data.frame':   100 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;   .. ..$ ACTS      : chr [1:100] "GrainsCrops" "MeatLstk" "Extraction" "ProcFood" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Region    : chr [1:100] "Oceania" "Oceania" "Oceania" "Oceania" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Subtotal  : chr [1:100] "TOTAL" "TOTAL" "TOTAL" "TOTAL" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Value     : num [1:100] -5.28 -8.47 -1.62 -3.57 8.39 ...</span></span>
<span><span class="co">#&gt;   .. ..$ Variable  : chr [1:100] "qo" "qo" "qo" "qo" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Dimension : chr [1:100] "ACTS*REG" "ACTS*REG" "ACTS*REG" "ACTS*REG" ...</span></span>
<span><span class="co">#&gt;   .. ..$ Experiment: chr [1:100] "sl4_data1" "sl4_data1" "sl4_data1" "sl4_data1" ...</span></span>
<span></span>
<span><span class="co"># Rename experiment names</span></span>
<span><span class="va">data_exp_renamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, </span>
<span>                             experiment_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EXP1"</span>, <span class="st">"EXP2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_exp_renamed</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EXP1" "EXP2"</span></span>
<span></span>
<span><span class="co"># Merge variable data across multiple datasets with custom experiment names</span></span>
<span><span class="va">data_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>,</span>
<span>                            experiment_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EXP1"</span>, <span class="st">"EXP2"</span><span class="op">)</span>, </span>
<span>                            merge_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            rename_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>REG <span class="op">=</span> <span class="st">"Region"</span>, COMM <span class="op">=</span> <span class="st">"Commodity"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_merged</span><span class="op">$</span><span class="va">merged</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Now, let’s delve into <code>&lt;get_data_by_dims&gt;</code>. This
command offers an additional feature compared to
<code>&lt;get_data_by_var&gt;</code>: it allows for
<code>patter_mix</code>. For instance, REG<em>COMM and COMM</em>REG can
be treated as equivalent when merging data (this only applies if
merge_data = TRUE). You can experiment with the following commands:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge data by dimensions (e.g., REG*COMM != COMM*REG)</span></span>
<span><span class="va">data_no_mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_dims.html">get_data_by_dims</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, </span>
<span>                                merge_data <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                pattern_mix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge data while allowing interchangeable dimensions (e.g., REG*COMM = COMM*REG)</span></span>
<span><span class="va">data_pattern_mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_dims.html">get_data_by_dims</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, </span>
<span>                                       merge_data <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                       pattern_mix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This flexibility is particularly useful when working with datasets
where dimension order does not affect the interpretation of the
data.</p>
</div>
<div class="section level2">
<h2 id="grouping-data-by-dimension">Grouping Data By Dimension<a class="anchor" aria-label="anchor" href="#grouping-data-by-dimension"></a>
</h2>
<p>The <code>&lt;group_data_by_dims&gt;</code> function is a powerful
tool that <strong>categorizes extracted data into meaningful
dimension-based groups</strong>. This is a key feature of this package,
as it allows GEMPACK users (particularly those working with GTAP model
results) to merge data into a structured and useful dataframe.</p>
<p>For example, if users want to retrieve all variables defined by
<code>REG</code>, they can simply set <code>REG</code> as a priority
while also assigning a new column name for <code>REG</code>, such as
<code>REG = "Region"</code>. The function will then <strong>merge all
datasets that contain <code>REG</code> as a dimension element into a
single dataframe</strong>, ensuring that all relevant data is
consolidated.</p>
<p>Unlike <code>&lt;get_data_by_dims&gt;</code>, which focuses on
extracting data, <code>&lt;group_data_by_dims&gt;</code>
<strong>organizes and merges data dynamically</strong> based on the
structure and priority defined by the user.</p>
<p>It is particularly useful because: - It <strong>groups extracted data
by dimension levels</strong> (<code>1D</code>, <code>2D</code>,
<code>3D</code>, …). - Users can <strong>define priority-based
merging</strong> (e.g., prioritizing <code>REG</code> first, then
<code>COMM</code>). The function first attempts to merge all datasets
containing <code>REG</code>, then moves on to merge datasets containing
<code>COMM</code>. If a dataset contains <code>REG*COMM</code>, it will
be included in the <code>REG</code> output. - It <strong>automatically
renames dimensions</strong> (<code>auto_rename = TRUE</code>) to improve
dataset compatibility while preserving all variable information. - It
<strong>transforms data into a structured long format</strong>,
simplifying further analysis. - It <strong>supports merging grouped data
across multiple datasets</strong>. - It <strong>filters subtotal
levels</strong>, allowing users to retain <code>"TOTAL"</code> values or
decomposed components as needed. - If certain datasets cannot be merged,
the function generates a <strong>detailed report identifying the root of
the issue</strong>, enabling users to manually manipulate the data if
necessary. - This function primarily focuses on <strong>1D and 2D
data</strong>, ensuring that <strong>higher-dimension data (&gt;2D) is
merged only with datasets that share the same pattern</strong>.</p>
<div class="section level3">
<h3 id="understanding-priority-list-in-group_data_by_dims">
<strong>Understanding Priority List in
<code>group_data_by_dims</code></strong><a class="anchor" aria-label="anchor" href="#understanding-priority-list-in-group_data_by_dims"></a>
</h3>
<p>The <strong>priority list</strong> in
<code>&lt;group_data_by_dims&gt;</code> allows users to control
<strong>how dimensions are grouped and merged</strong>.<br>
By defining priorities, the function ensures that <strong>datasets
containing high-priority dimensions are merged as much as
possible</strong>, but <strong>only if they share the same
structure</strong>.</p>
<div class="section level4">
<h4 id="single-priority-example-reg-only">
<strong>1. Single Priority Example (<code>REG</code>
only)</strong><a class="anchor" aria-label="anchor" href="#single-priority-example-reg-only"></a>
</h4>
<p>If we prioritize only <code>REG</code>, the function will
<strong>attempt to merge all datasets containing <code>REG</code> as
much as possible</strong>, while ensuring that datasets with different
structures remain separate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define single priority (Only Region-based grouping)</span></span>
<span><span class="va">priority_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Region"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Grouping data with a single priority</span></span>
<span><span class="va">grouped_data_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_data_by_dims.html">group_data_by_dims</a></span><span class="op">(</span><span class="st">"ALL"</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>,</span>
<span>                                          priority <span class="op">=</span> <span class="va">priority_list</span>, auto_rename <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_single</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1D" "2D" "3D" "4D"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_single</span><span class="op">[[</span><span class="st">"1D"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Region" "Other"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_single</span><span class="op">[[</span><span class="st">"2D"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Region"</span></span></code></pre></div>
<p>What happens here? - The function tries to merge all datasets
containing REG, but only if they share the same data structure. - If
some datasets have different structures, they will remain separate. -
The merging happens separately in each data dimension (e.g., 1D, 2D,
etc.).</p>
</div>
<div class="section level4">
<h4 id="multiple-priorities-example-comm-before-reg">
<strong>2. Multiple Priorities Example (<code>COMM</code> before
<code>REG</code>)</strong><a class="anchor" aria-label="anchor" href="#multiple-priorities-example-comm-before-reg"></a>
</h4>
<p>If we prioritize <strong><code>COMM</code> first and <code>REG</code>
second</strong>, datasets containing <code>COMM</code> will be
<strong>merged first</strong>, followed by <code>REG</code>, <strong>as
much as possible</strong> while ensuring datasets with different
structures remain separate.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define multiple priority levels: Sector first, then Region</span></span>
<span><span class="va">priority_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Sector"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMM"</span>, <span class="st">"ACTS"</span><span class="op">)</span>,</span>
<span>  <span class="st">"Region"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Grouping data with multiple priorities</span></span>
<span><span class="va">grouped_data_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_data_by_dims.html">group_data_by_dims</a></span><span class="op">(</span><span class="st">"ALL"</span>, <span class="va">sl4_data1</span>, </span>
<span>                                            priority <span class="op">=</span> <span class="va">priority_list</span>, </span>
<span>                                            auto_rename <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_multiple</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1D" "2D" "3D" "4D"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_multiple</span><span class="op">[[</span><span class="st">"1D"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sector" "Region" "Other"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_multiple</span><span class="op">[[</span><span class="st">"2D"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sector" "Region"</span></span></code></pre></div>
<p>What happens here?<br>
- The function attempts to merge all datasets containing
<code>COMM</code> and <code>ACTS</code> first, both of which are merged
into the <strong>Sector</strong> column before attempting to merge other
datasets with <code>REG</code>, as long as they share the same
structure.<br>
- Therefore, if datasets contain <code>REG*COMM</code> and
<code>REG*ACTS</code>, they will be merged into the
<strong>Sector</strong> dataframe, <strong>not the REG
dataframe</strong>. - If datasets cannot be merged due to structural
differences, they are kept separate in their respective dimension
groups.</p>
</div>
</div>
<div class="section level3">
<h3 id="understanding-auto_rename-in-group_data_by_dims">
<strong>Understanding <code>auto_rename</code> in
<code>group_data_by_dims</code></strong><a class="anchor" aria-label="anchor" href="#understanding-auto_rename-in-group_data_by_dims"></a>
</h3>
<p>The <code>auto_rename</code> option in
<code>&lt;group_data_by_dims&gt;</code> plays a crucial role in ensuring
<strong>successful and smooth merging</strong> of datasets.<br>
When enabled, it <strong>automatically renames lower-priority
dimensions</strong> to <code>"Dim1"</code>, <code>"Dim2"</code>, etc.,
which allows datasets with slightly different dimension names to be
merged, while still preserving the original dimension structure.</p>
<p>Without <code>auto_rename</code>, datasets with similar but
non-identical dimension names <strong>may fail to merge</strong>,
leading to separate outputs instead of a unified dataset.</p>
<div class="section level4">
<h4 id="example-grouping-without-auto_rename">
<strong>Example: Grouping Without
<code>auto_rename</code></strong><a class="anchor" aria-label="anchor" href="#example-grouping-without-auto_rename"></a>
</h4>
<p>By default (<code>auto_rename = FALSE</code>), the function
<strong>keeps all original dimension names</strong>.<br>
This means datasets that contain <strong>similar but not identical
dimensions</strong> (e.g., <code>REG*ENDW</code> and
<code>REG*END</code>) <strong>cannot be merged</strong>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define priority: First by Sector (COMM, ACTS), then by Region (REG)</span></span>
<span><span class="va">priority_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Sector"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMM"</span>, <span class="st">"ACTS"</span><span class="op">)</span>,</span>
<span>  <span class="st">"Region"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Grouping data without auto_rename</span></span>
<span><span class="va">grouped_data_no_rename</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_data_by_dims.html">group_data_by_dims</a></span><span class="op">(</span><span class="st">"ALL"</span>, <span class="va">sl4_data1</span>, </span>
<span>                                             priority <span class="op">=</span> <span class="va">priority_list</span>, </span>
<span>                                             auto_rename <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_no_rename</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1D"     "2D"     "3D"     "4D"     "report"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_no_rename</span><span class="op">[[</span><span class="st">"1D"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sector"   "Region"   "unmerged"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grouped_data_no_rename</span><span class="op">[[</span><span class="st">"2D"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sector"   "unmerged"</span></span></code></pre></div>
<p>Without <code>auto_rename</code>, the number of mergeable dataframes
will be <strong>less</strong> compared to when
<code>auto_rename = TRUE</code>, as it <strong>does not allow merging
across different dimension names</strong>, even if their structures are
otherwise compatible.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="reshaping-and-renaming-data">Reshaping and Renaming Data<a class="anchor" aria-label="anchor" href="#reshaping-and-renaming-data"></a>
</h2>
<div class="section level3">
<h3 id="pivoting-data">Pivoting Data<a class="anchor" aria-label="anchor" href="#pivoting-data"></a>
</h3>
<p>The <code>&lt;pivot_data&gt;</code> function transforms long-format
data from SL4 or HAR objects into a wide format, making it more suitable
for analysis and visualization. This transformation is particularly
useful when working with GEMPACK outputs that need to be reshaped for
reporting or further processing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract data to pivot</span></span>
<span><span class="va">data_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="st">"pca"</span><span class="op">)</span>, <span class="va">sl4_data1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pivot a single column</span></span>
<span><span class="va">pivoted_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pivot_data.html">pivot_data</a></span><span class="op">(</span><span class="va">data_multiple</span>, </span>
<span>                             pivot_cols <span class="op">=</span> <span class="st">"REG"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pivot multiple columns</span></span>
<span><span class="va">pivoted_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pivot_data.html">pivot_data</a></span><span class="op">(</span><span class="va">data_multiple</span>, </span>
<span>                            pivot_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMM"</span>, <span class="st">"REG"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pivot-data-hierarchy">Pivot Data Hierarchy<a class="anchor" aria-label="anchor" href="#pivot-data-hierarchy"></a>
</h3>
<p>While <code>pivot_data</code> provides basic pivoting functionality,
<code>pivot_data_hierarchy</code> offers enhanced capabilities for
creating hierarchical pivot tables similar to those found in spreadsheet
applications. This function is particularly useful when you need to
maintain dimensional hierarchies in your output or create Excel-ready
pivot tables.</p>
<p>Key differences from regular pivoting:</p>
<ul>
<li>Maintains hierarchical relationships between pivot columns</li>
<li>Supports direct Excel export with properly formatted headers</li>
<li>Preserves dimension order as specified in pivot_cols</li>
<li>Creates nested column headers reflecting the hierarchy</li>
<li><strong>Must be exported to XLSX only using the command option
<code>&lt;export = TRUE, file_path = "./path/to/output"&gt;</code>. This
pivot table cannot be exported with the <export> command.</export></strong></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create hierarchical pivot without export</span></span>
<span><span class="va">pivot_hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pivot_data_hierarchy.html">pivot_data_hierarchy</a></span><span class="op">(</span><span class="va">data_multiple</span>, </span>
<span>                                  pivot_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span>, <span class="st">"COMM"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create and export to Excel in one step</span></span>
<span><span class="va">pivot_export</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pivot_data_hierarchy.html">pivot_data_hierarchy</a></span><span class="op">(</span><span class="va">data_multiple</span>, </span>
<span>                                   pivot_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span>, <span class="st">"COMM"</span><span class="op">)</span>,</span>
<span>                                   export <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                   file_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"pivot_output.xlsx"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The hierarchy in the resulting pivot table follows the order
specified in <code>pivot_cols</code>. For example, when using
<code>c("REG", "COMM")</code>, the output will show:</p>
<ul>
<li>First level: Region (REG)<br>
</li>
<li>Second level: Commodity (COMM) nested under each region</li>
<li>Values arranged according to this hierarchy</li>
</ul>
<p>When exported to Excel, the hierarchical structure is automatically
formatted with:</p>
<ul>
<li>Properly aligned multi-level column headers</li>
<li>Bold formatting for header levels<br>
</li>
<li>Clean sheet names for multiple variables</li>
</ul>
</div>
<div class="section level3">
<h3 id="rename-dimensions">Rename Dimensions<a class="anchor" aria-label="anchor" href="#rename-dimensions"></a>
</h3>
<p>The <code>rename_dims</code> function provides flexible renaming
capabilities for dimensions in SL4 or HAR objects. You can rename either
dimension names, list names, or both.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a renaming map</span></span>
<span><span class="va">mapping_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span> old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span>, <span class="st">"COMM"</span><span class="op">)</span>,</span>
<span> new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="st">"Commodity"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename dimensions only</span></span>
<span><span class="va">renamed_dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename_dims.html">rename_dims</a></span><span class="op">(</span><span class="va">sl4_data1</span>, <span class="va">mapping_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename both dimensions and list names</span></span>
<span><span class="va">renamed_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename_dims.html">rename_dims</a></span><span class="op">(</span><span class="va">sl4_data1</span>, <span class="va">mapping_df</span>, rename_list_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The mapping dataframe must have two columns: the first for current
names and the second for new names. The function preserves data
structure while updating dimension labels according to the specified
mapping.</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-data-to-gempack--har-format">Saving Data to GEMPACK <code>.HAR</code> Format<a class="anchor" aria-label="anchor" href="#saving-data-to-gempack--har-format"></a>
</h2>
<p>This function is particularly useful when: - Creating custom HAR
files for simulation inputs or aggregated datasets<br>
- Converting R-based results into GEMPACK-readable format<br>
- Exporting modified or merged results from GTAP-style models for use in
RunDynam or RunGTAP</p>
<div class="section level3">
<h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<ul>
<li>Supports both <strong>1C (string)</strong> and <strong>RE
(real)</strong> headers<br>
</li>
<li>Automatically generates 1C dimension sets (e.g., <code>REG</code>,
<code>COMM</code>, <code>ENDW</code>)<br>
</li>
<li>Accepts data frames or arrays with flexible column naming<br>
</li>
<li>Writes associated set headers when
<code>export_sets = TRUE</code><br>
</li>
<li>Maintains full GEMPACK binary structure with no size
limitation<br>
</li>
<li>Supports up to seven dimensions and approximately 2 million elements
per chunk</li>
<li>Allows <strong>dimension renaming</strong> and supports
<strong>duplicate dimension names</strong> (e.g.,
<code>COMMxREGxREG</code>) during export</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example HAR data</span></span>
<span><span class="va">har_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"TAR10-WEL.har"</span>, package <span class="op">=</span> <span class="st">"HARplus"</span><span class="op">)</span></span>
<span><span class="va">har_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_harx.html">load_harx</a></span><span class="op">(</span><span class="va">har_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract one matrix for demonstration</span></span>
<span><span class="va">welfare_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="st">"C17"</span>, <span class="va">har_data</span><span class="op">)</span></span>
<span><span class="va">welfare_matrix</span> <span class="op">&lt;-</span> <span class="va">welfare_data</span><span class="op">[[</span><span class="st">"har_data"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"C17"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Save as a single HAR file</span></span>
<span><span class="fu"><a href="../reference/save_har.html">save_har</a></span><span class="op">(</span></span>
<span>  data_list   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>WELF <span class="op">=</span> <span class="va">welfare_matrix</span><span class="op">)</span>,</span>
<span>  file_path   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"output_single.har"</span><span class="op">)</span>,</span>
<span>  dimensions  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>WELF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REG"</span>, <span class="st">"COLUMN"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  value_cols  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>WELF <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span>,</span>
<span>  long_desc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>WELF <span class="op">=</span> <span class="st">"Welfare Decomposition"</span><span class="op">)</span>,</span>
<span>  dim_rename  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>RTMS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>COMM <span class="op">=</span> <span class="st">"COMM"</span>, SREG <span class="op">=</span> <span class="st">"REG"</span>, DREG <span class="op">=</span> <span class="st">"REG"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  export_sets <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dim_order   <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lowercase   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="exporting-data-to-csvstatatextrdsxlsx">Exporting Data to CSV/STATA/TEXT/RDS/XLSX<a class="anchor" aria-label="anchor" href="#exporting-data-to-csvstatatextrdsxlsx"></a>
</h2>
<p>The <code>export_data</code> function allows you to export SL4 and
HAR data into various formats. Supported formats include:
<code>"csv"</code>, <code>"xlsx"</code>, <code>"stata"</code>,
<code>"txt"</code>, and <code>"rds"</code>. You can export single data
frames or multi-variable results while preserving their structure.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract data</span></span>
<span><span class="va">data_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data_by_var.html">get_data_by_var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qo"</span>, <span class="st">"pca"</span><span class="op">)</span>, <span class="va">sl4_data1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export </span></span>
<span><span class="fu"><a href="../reference/export_data.html">export_data</a></span><span class="op">(</span><span class="va">data_multiple</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"output_directory"</span><span class="op">)</span>, </span>
<span>           format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"csv"</span>, <span class="st">"xlsx"</span>, <span class="st">"stata"</span>, <span class="st">"txt"</span>, <span class="st">"rds"</span><span class="op">)</span>,</span>
<span>           create_subfolder <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           multi_sheet_xlsx <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-data-structure">Exploring Data Structure<a class="anchor" aria-label="anchor" href="#exploring-data-structure"></a>
</h2>
<p>Since this package is designed to handle multiple inputs with a
similar structure, such as simulation outputs from the GTAP model with
different shocks or experiments, the first important step is to
understand the data structure. This process can also be useful even with
a single input, as it helps in analyzing the data shape and dimension
size of each variable.</p>
<p>There are a couple of commands available to illustrate the data
structure, all of which can be applied to both <code>.har</code> and
<code>.sl4</code> files in the same manner.</p>
<div class="section level3">
<h3 id="variable-structure">Variable Structure<a class="anchor" aria-label="anchor" href="#variable-structure"></a>
</h3>
<p>To get a summary of variable names, dimension counts, dimension
patterns, and optionally the column and observation counts for one or
multiple variables from a single or multiple datasets (return as
separate lists):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># (1) Getting all variables from the input file</span></span>
<span><span class="va">vars_har_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_var_structure.html">get_var_structure</a></span><span class="op">(</span><span class="st">"ALL"</span>, <span class="va">har_data1</span><span class="op">)</span></span>
<span><span class="va">vars_sl4_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_var_structure.html">get_var_structure</a></span><span class="op">(</span>, <span class="va">har_data1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (2) Getting selected variables</span></span>
<span><span class="va">var_sl4_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_var_structure.html">get_var_structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pds"</span>,<span class="st">"pfd"</span>,<span class="st">"pms"</span><span class="op">)</span>, <span class="va">sl4_data1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">var_sl4_sum</span><span class="op">[[</span><span class="st">"sl4_data1"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Variable    Dimensions DimSize DataShape</span></span>
<span><span class="co">#&gt; 1      pds      COMM*REG       2     10x10</span></span>
<span><span class="co">#&gt; 2      pfd COMM*ACTS*REG       3  10x10x10</span></span>
<span><span class="co">#&gt; 3      pms      COMM*REG       2     10x10</span></span>
<span></span>
<span></span>
<span><span class="co"># (3) Including column size and number of observation in the summary</span></span>
<span><span class="va">var_sl4_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_var_structure.html">get_var_structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pds"</span>,<span class="st">"pfd"</span>,<span class="st">"pms"</span><span class="op">)</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>, </span>
<span>                                 include_col_size <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">var_sl4_sum</span><span class="op">[[</span><span class="st">"sl4_data1"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Variable    Dimensions DimSize DataShape No.Col No.Obs</span></span>
<span><span class="co">#&gt; 1      pds      COMM*REG       2     10x10     10     10</span></span>
<span><span class="co">#&gt; 2      pfd COMM*ACTS*REG       3  10x10x10    100     10</span></span>
<span><span class="co">#&gt; 3      pms      COMM*REG       2     10x10     10     10</span></span></code></pre></div>
<p>Understanding the data structure is crucial for aggregating data
across multiple experiments (inputs). Even when using the same
variables, different experiments may have varying column sizes or data
structures due to factors such as subtotal effects and other
experimental settings. These discrepancies can lead to errors if the
merging process relies solely on variable names without accounting for
structural differences.</p>
<p>To compare data structures across multiple experiments, use the
following command:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># (1) Comparing all variable structures across experiments </span></span>
<span><span class="va">vars_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_var_structure.html">compare_var_structure</a></span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="st">"ALL"</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vars_comparison</span><span class="op">$</span><span class="va">match</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Variable    Dimensions DataShape input1_ColSize input2_ColSize</span></span>
<span><span class="co">#&gt; 1      afa COMM*ACTS*REG  10x10x10            100            100</span></span>
<span><span class="co">#&gt; 2    afall COMM*ACTS*REG  10x10x10            100            100</span></span>
<span></span>
<span><span class="co"># (2) Comparing selected variable structures across experiments </span></span>
<span><span class="va">var_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_var_structure.html">compare_var_structure</a></span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pds"</span>, <span class="st">"pms"</span><span class="op">)</span>, <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">var_comparison</span><span class="op">$</span><span class="va">match</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Variable Dimensions DataShape input1_ColSize input2_ColSize</span></span>
<span><span class="co">#&gt; 1      pds   COMM*REG     10x10             10             10</span></span>
<span><span class="co">#&gt; 2      pms   COMM*REG     10x10             10             10</span></span></code></pre></div>
<p>This function returns a list containing: - <strong>match</strong>: A
data frame of variables with identical dimension names and structures
across inputs. - <strong>diff</strong> (if any): A data frame listing
variables with structural mismatches. Note: If this list appears, you
may need to focus on handling these variables. It is designed to report
potential issue-causing variables when merging datasets.</p>
<p>Additionally, the function includes the
<code>&lt;keep_unique&gt;</code> option (default: <code>FALSE</code>)
which allows users to extract variables with unique names and structures
across all inputs. This is particularly useful when inputs contain
different sets of variables that need to be combined into a final
dataset.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># (3) Extracting unique variable structures</span></span>
<span><span class="va">unique_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_var_structure.html">compare_var_structure</a></span><span class="op">(</span>, </span>
<span>                                     <span class="va">sl4_data1</span>, <span class="va">sl4_data2</span>,</span>
<span>  keep_unique <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">unique_vars</span><span class="op">$</span><span class="va">match</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Variable    Dimensions DimSize DataShape</span></span>
<span><span class="co">#&gt; 1       afa COMM*ACTS*REG       3  10x10x10</span></span>
<span><span class="co">#&gt; 2     afall COMM*ACTS*REG       3  10x10x10</span></span>
<span><span class="co">#&gt; 3     afcom          COMM       1        10</span></span>
<span><span class="co">#&gt; 4       afe ENDW*ACTS*REG       3   5x10x10</span></span>
<span><span class="co">#&gt; 5    afeall ENDW*ACTS*REG       3   5x10x10</span></span>
<span><span class="co">#&gt; 6    afecom          ENDW       1         5</span></span>
<span><span class="co">#&gt; 7    afereg           REG       1        10</span></span>
<span><span class="co">#&gt; 8    afesec          ACTS       1        10</span></span>
<span><span class="co">#&gt; 9     afreg           REG       1        10</span></span>
<span><span class="co">#&gt; 10    afsec          ACTS       1        10</span></span></code></pre></div>
<p>This function returns a list containing: - <strong>match</strong>: A
data frame displaying distinct variable structures found across inputs.
- <strong>diff</strong> (if any): A data frame detailing how structures
differ between inputs.</p>
<p>To sum up, - <code>keep_unique = FALSE</code> → Checks whether
variables match across inputs. - <code>keep_unique = TRUE</code> →
Extracts all unique variable structures, regardless of whether they
match, while reports any variables that do not align.</p>
</div>
<div class="section level3">
<h3 id="dimension-structure">Dimension Structure<a class="anchor" aria-label="anchor" href="#dimension-structure"></a>
</h3>
<p>The following commands can be used to retrieve unique dimension names
as patterns and their corresponding elements:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># (1) Extracting dimension patterns (e.g., REG*COMM*ACTS)</span></span>
<span><span class="va">dims_strg_har</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dim_patterns.html">get_dim_patterns</a></span><span class="op">(</span><span class="va">har_data1</span>, <span class="va">har_data2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dims_strg_har</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "scalar"     "scalar"     "scalar"     "REG*COLUMN"</span></span>
<span></span>
<span><span class="co"># (2) Extracting unique dimension patterns (e.g., REG*COMM*ACTS)</span></span>
<span><span class="va">dims_strg_har</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dim_patterns.html">get_dim_patterns</a></span><span class="op">(</span><span class="va">har_data1</span>, <span class="va">har_data2</span>,</span>
<span>                                  keep_unique <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dims_strg_har</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "scalar"       "REG*COLUMN"   "ALLOCEFF*REG" "REG*CTAX"</span></span>
<span></span>
<span><span class="co"># (2) Extracting dimension elements e.g., REG, COMM, ACTS</span></span>
<span><span class="va">dims_strg_har_uniq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_dim_elements.html">get_dim_elements</a></span><span class="op">(</span><span class="va">har_data1</span>, <span class="va">har_data2</span>, </span>
<span>                                       keep_unique <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dims_strg_har_uniq</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "REG"      "COLUMN"   "ALLOCEFF" "CTAX"</span></span></code></pre></div>
<div class="section level4">
<h4 id="patterns-vs--elements">Patterns vs. Elements<a class="anchor" aria-label="anchor" href="#patterns-vs--elements"></a>
</h4>
<p>Patterns represent structured dimension names (e.g.,
<code>"REG*COMM*ACTS"</code>), while elements extract individual
dimension elements (e.g., <code>"REG"</code>, <code>"COMM"</code>,
<code>"ACTS"</code>).</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pattawee Puangchit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
